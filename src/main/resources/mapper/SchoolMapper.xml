<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.isp.dao.SchoolDao">

    <resultMap id="SchoolBaseMap" type="com.isp.entity.School">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="info" property="info" jdbcType="VARCHAR"/>
        <result column="address" property="address" jdbcType="VARCHAR"/>
        <result column="image" property="image" jdbcType="VARCHAR"/>
        <result column="isGood" property="isGood" jdbcType="NUMERIC"/>
        <association property="schoolLevel" javaType="com.isp.entity.SchoolLevel">
            <result column="levelname" property="name"></result>
        </association>
        <association property="region" javaType="com.isp.entity.Region">
            <result column="regionname" property="name"></result>
        </association>
    </resultMap>

    <select id="getSchoolAll" resultType="com.isp.entity.School">
        SELECT * FROM school;
    </select>

    <select id="getSchoolByPage" parameterType="java.lang.String" resultMap="SchoolBaseMap">
        SELECT school.id, school.name, school_level.name as levelname, info, region.name as regionname,
        address, image, isGood FROM school, school_level, region where level = school_level.id and
        region_id = region.id ORDER BY id limit ${start}, ${end}
    </select>

    <select id="getTotalNumber" parameterType="java.lang.String" resultType="java.lang.Integer">
        SELECT COUNT(id) FROM school
    </select>

    <select id="getSchoolByName" parameterType="java.lang.String" resultMap="SchoolBaseMap">
        SELECT school.id, school.name, school_level.name as levelname, info, region.name as regionname,
        address, image, isGood FROM school, school_level, region where level = school_level.id and
        region_id = region.id and school.name = '${name}'
    </select>

    <select id="getSchoolById" parameterType="java.lang.Integer" resultType="com.isp.entity.School">
        SELECT * FROM school WHERE id = ${id}
    </select>

    <insert id="insertSchool" parameterType="java.lang.String">
        INSERT INTO school (name, level, info, region_id, address, image, isGood)
        VALUE ('${name}',${level},'${info}',${region_id},'${address}','${image}',${isGood})
    </insert>

    <update id="updateSchool" parameterType="java.lang.Integer">
        UPDATE school SET name = '${name}', level = ${level}, info = '${info}',
        region_id = ${region_id}, address = '${address}', image = '${image}', isGood = ${isGood} WHERE id = ${id}
    </update>

    <delete id="deleteById" parameterType="java.lang.Integer">
        DELETE FROM school WHERE id = ${id}
    </delete>
</mapper>